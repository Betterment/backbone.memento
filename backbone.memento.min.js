// Backbone.Memento v0.4.1a
//
// Copyright (C)2011 Derick Bailey, Muted Solutions, LLC
// Distributed Under MIT Liscene
//
// Documentation and Full License Availabe at:
// http://github.com/derickbailey/backbone.memento

// ----------------------------
// Backbone.Memento
// ----------------------------
Backbone.Memento=(function(f,c){var d=function(g,i){this.version="0.4.1a";i=c.extend({ignore:[]},i);var j=new a(g,i);var k=new e(g,i);var h=function(l,m){if(!l){return}j.deserialize(l,m)};this.store=function(){var l=j.serialize();k.push(l)};this.restore=function(m){var l=k.pop();h(l,m)};this.restart=function(m){var l=k.rewind();h(l,m)}};var b=function(g){if(g instanceof f.Model){this.removeAttr=function(i,h){g.unset(i,h)};this.restore=function(h){g.set(h)}}else{this.removeAttr=function(h){g.remove(h)};this.restore=function(h){g.reset(h)}}};var a=function(g,i){var k=new b(g);function m(p,n){p=c.clone(p);if(n.hasOwnProperty("ignore")&&n.ignore.length>0){for(var o in n.ignore){var q=n.ignore[o];delete p[q]}}return p}function l(p,q){var o=[];if(!p||!q){return o}for(var n in q){if(q.hasOwnProperty(n)){if(!p.hasOwnProperty(n)){o.push(n)}}}return o}function j(o,r,p){for(var q in r){var n=r[q];k.removeAttr(n,p)}}function h(o,q){var r=m(o,q);var n=g.toJSON();n=m(n,q);var p=l(r,n);j(g,p,q);k.restore(r)}this.serialize=function(){var n=g.toJSON();n=m(n,i);return n};this.deserialize=function(n,o){o=c.extend({},i,o);h(n,o)}};var e=function(h,i){var j;function g(){j=[]}this.push=function(k){j.push(k)};this.pop=function(k){var l=j.pop();return l};this.rewind=function(){var k=j[0];g();return k};g()};return d})(Backbone,_);